/*! ember-oauth2 25-03-2014 */
!function(){void 0===Ember.OAuth2&&(Ember.OAuth2=Ember.Object.extend(Ember.Evented,{init:function(){this._super(),this.providerConfig=Ember.OAuth2.config[this.get("providerId")],this.set("statePrefix","state"),this.set("tokenPrefix","token"),this.setProperties(this.providerConfig),this.on("redirect",this.handleRedirect),this.on("success",this._onSuccess),this.on("error",this._onError)},version:function(){return Ember.OAuth2.version},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},now:function(){return Math.round((new Date).getTime()/1e3)},requestObj:function(){var a={response_type:"token"};return a.providerId=this.providerId,a.state=this.state,a.client_id=this.clientId,a.state=this.state,this.scope&&(a.scope=this.scope),a},authUri:function(){null===this.state&&(this.state=this.uuid());var a=this.authBaseUri;return a+="?response_type=token&redirect_uri="+encodeURIComponent(this.redirectUri)+"&client_id="+encodeURIComponent(this.clientId)+"&state="+encodeURIComponent(this.state),this.scope&&(a+="&scope="+encodeURIComponent(this.scope).replace("%20","+")),a},authorize:function(){if(!this.providerId)throw new Error("No provider id given.");if(!this.clientId)throw new Error("No client id given.");if(!this.authBaseUri)throw new Error("No auth base uri given.");if(!this.redirectUri)throw new Error("No redirect uri given.");var a=this.authUri();this.clearStates(),this.saveState(this.state,this.requestObj());var b=window.open(a,"Authorize","height=600, width=450");window.focus&&b.focus()},authSuccess:function(a){return a.access_token},generateToken:function(a){var b={};return b.provider_id=this.providerId,b.expires_in=this.expiresIn(a.expires_in),b.scope=this.scope,b.access_token=a.access_token,b},expiresIn:function(a){return this.now()+parseInt(a,10)},onRedirect:function(a,b){Ember.Logger.warn("Ember.OAuth2.onRedirect is deprecated. Please use .trigger('redirect') instead."),this.trigger("redirect",a,b)},handleRedirect:function(a,b){var c=this.parseCallback(a);if(this.authSuccess(c)){var d=this.getState(c.state);this.checkState(d),this.saveToken(this.generateToken(c)),this.trigger("success",d)}else this.trigger("error",c);b&&"function"==typeof b&&b()},_onSuccess:function(a){"function"==typeof this.onSuccess&&(Ember.Logger.warn("Ember.OAuth2.onSuccess is deprecated. Bind your callbacks using .on('success', fn) instead."),this.onSuccess(a))},_onError:function(a){"function"==typeof this.onError&&(Ember.Logger.warn("Ember.OAuth2.onError is deprecated. Bind your callbacks using .on('error', fn) instead."),this.onError(a))},checkState:function(a){if(!a)throw new Error("Could not find state.");if(a.state!==this.state)throw new Error("State returned from the server did not match the local saved state.")},parseCallback:function(a){for(var b,c={},d=a.substring(1),e=/([^#?&=]+)=([^&]*)/g;null!==(b=e.exec(d));)c[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return c},saveState:function(a,b){window.localStorage.setItem(this.statePrefix+"-"+a,JSON.stringify(b))},getState:function(a){var b=JSON.parse(window.localStorage.getItem(this.statePrefix+"-"+a));return window.localStorage.removeItem(this.statePrefix+"-"+a),b},clearStates:function(){for(var a=new RegExp("^"+this.statePrefix+"-.*","g"),b=0;b<window.localStorage.length;b++)for(var c=window.localStorage.key(b);a.exec(c);)window.localStorage.removeItem(c)},saveToken:function(a){window.localStorage.setItem(this.tokenPrefix+"-"+this.providerId,JSON.stringify(a))},getToken:function(){var a=JSON.parse(window.localStorage.getItem(this.tokenPrefix+"-"+this.providerId));return a&&a.access_token?a:null},getAccessToken:function(){var a=this.getToken();return a?a.access_token:null},accessTokenIsExpired:function(){var a=this.getToken();return a?this.now()>=a.expires_in?!0:!1:!0},expireAccessToken:function(){var a=this.getToken();return a?(a.expires_in=0,void this.saveToken(a)):null}}));var a="0.2.3";Ember.OAuth2.version=a,Ember.OAuth2.config={}}(this);